
module handshake_mechanism(
input clk,rst_n,

input [1:0] data_in,
input valid_in,
output ready_out,

output reg [1:0] data_out,
output reg  valid_out,
input ready_in
    );
    
    assign ready_out = (!valid_out) || (valid_out && ready_in);
    
    always@(posedge clk or negedge rst_n)
     begin
    if(!rst_n) 
    begin
    valid_out <= 1'b0;
    data_out <= 1'b0;
    end
    
    else if(ready_out && valid_in) begin
    data_out <= data_in;
    valid_out <= 1'b1;
    end
    
    else if(valid_out && ready_in)
    begin
    //data has been accepted by the destination
    valid_out <=1'b0;
    end
    
    end 
    
endmodule